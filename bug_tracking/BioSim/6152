From myers@eng.utah.edu  Thu Aug 21 08:19:47 2014
Return-Path: <myers@eng.utah.edu>
Received: from bowie.eng.utah.edu (bowie.eng.utah.edu [155.98.110.113])
	by chou.ece.utah.edu (8.14.7/8.14.4) with ESMTP id s7LEJkho009676
	for <atacs-bugs@vlsigroup.ece.utah.edu>; Thu, 21 Aug 2014 08:19:46 -0600
Received: from [74.212.139.166] (helo=[172.20.1.232])
	by bowie.eng.utah.edu with esmtpsa (TLSv1:AES128-SHA:128)
	(Exim 4.72 (FreeBSD))
	(envelope-from <myers@eng.utah.edu>)
	id 1XKTk0-000E4k-UP
	for atacs-bugs@vlsigroup.ece.utah.edu; Thu, 21 Aug 2014 08:53:29 -0600
From: "Chris J. Myers" <myers@ece.utah.edu>
Content-Type: multipart/alternative; boundary="Apple-Mail=_36382626-9315-4A02-AD19-C1F0DC13ED05"
Subject: BUG: layout causing problem during libsbml flatten
Date: Thu, 21 Aug 2014 08:19:45 -0600
References: <CAHLmBr1oh_EW6N8PfnUiZ_cn=6ZZ+9X4=4fnUCz-qFAc0rXvbw@mail.gmail.com>
To: Leandro Hikiji Watanabe <atacs-bugs@vlsigroup.ece.utah.edu>
Message-Id: <9A2E8EEF-9A61-4AE7-9979-2E5057AEF481@ece.utah.edu>
Mime-Version: 1.0 (Mac OS X Mail 7.3 \(1878.6\))
X-Mailer: Apple Mail (2.1878.6)
Sender: myers@eng.utah.edu


--Apple-Mail=_36382626-9315-4A02-AD19-C1F0DC13ED05
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=windows-1252



Begin forwarded message:

> From: Lucian Smith <lucianoelsmitho@gmail.com>
> Subject: Re: [libsbml-team] Errors during flatten
> Date: August 19, 2014 at 12:48:46 PM MDT
> To: "Chris J. Myers" <myers@ece.utah.edu>
> Cc: Frank Bergmann <fbergman@caltech.edu>, LibSBML Team =
<libsbml-team@caltech.edu>
>=20
> Man, that is tricky.  OK!  I'll see what I can do about this; I agree =
there should be a way to do it.
>=20
> -Lucian
>=20
>=20
> On Tue, Aug 19, 2014 at 11:08 AM, Chris J. Myers <myers@ece.utah.edu> =
wrote:
> I'm stuck.  I thought I could simply disable layout before saving and =
reloading as a libsbml document, but this does not work since I'm only =
saving and loading the top-level.  The lower levels models in separate =
files still have layout, and it is not practical to load and strip all =
of the files.  I need a way to say DO NOT flatten layout through the =
entire hierarchy.  =20
> Chris
>=20
>=20
> On Aug 19, 2014, at 11:19 AM, Lucian Smith <lucianoelsmitho@gmail.com> =
wrote:
>=20
>> The abortIfUnflattenable options refers to whether or not flattening =
has been implemented for that package or not--a few versions back, that =
meant that 'layout' would be ignored or stripped, since we had not =
implemented layout flattening.  But now, we have implemented flattening =
for layout, so that option is now ignored as far as 'layout' goes.
>>=20
>> You should indeed be able to strip the package before flattening, =
though, and your code should work.  If it's not, then something is awry.
>>=20
>> -Lucian
>>=20
>>=20
>> On Tue, Aug 19, 2014 at 10:05 AM, Chris J. Myers <myers@ece.utah.edu> =
wrote:
>> I thought setting abortIfUnflattenable "none" would allow it to =
continue.
>>=20
>> Also, I thought I removed the layout package with this code.  If not, =
how do I remove the layout before flatten:
>>=20
>> 			org.sbml.libsbml.SBMLReader reader =3D new =
org.sbml.libsbml.SBMLReader();
>> 			org.sbml.libsbml.SBMLDocument document =3D =
reader.readSBML(tempFile);
>> 			new File(tempFile).delete();
>> 		=09
>> 			=
document.enablePackage(org.sbml.libsbml.LayoutExtension.getXmlnsL3V1V1(), =
"layout", false);
>> 			// TODO: Hack to allow flatten to work as it =
crashes with arrays namespace
>> 			=
document.enablePackage(org.sbml.libsbml.ArraysExtension.getXmlnsL3V1V1(), =
"arrays", false);
>> 			=
document.enablePackage(org.sbml.libsbml.CompExtension.getXmlnsL3V1V1(), =
"comp", true);
>> 			document.setPackageRequired("comp", true);=20
>> 		=09
>>=20
>> On Aug 19, 2014, at 11:01 AM, Lucian Smith =
<lucianoelsmitho@gmail.com> wrote:
>>=20
>>> The model is invalid.  You would be able to see the problem by =
looking at the error log on the document that failed to flatten.  In =
this case:
>>>=20
>>> // line 567: (layout-20808 [Error]) The value of the =
'layout:reference'
>>> // attribute of a <generalGlyph> must be of the 'id' of
>>> // an existing element in the <model>.
>>> // Reference: L3V1 Layout V1 Section 3.11
>>>=20
>>> You reference an 'event0' that doesn't exist.
>>>=20
>>> -Lucian
>>>=20
>>>=20
>>> On Tue, Aug 19, 2014 at 9:54 AM, Frank Bergmann =
<fbergman@caltech.edu> wrote:
>>> the attachment did not make it through =85 could you send it to me?
>>>=20
>>> thanks
>>> Frank
>>>=20
>>> On Aug 19, 2014, at 9:50 AM, Chris J. Myers <myers@ece.utah.edu> =
wrote:
>>>=20
>>> > Hi,
>>> >
>>> > I'm trying to flatten a model and it is failing.  Not sure why.  =
Is there someway to get more information about why or make it less picky =
so it will not fail?
>>> >
>>> > Here is the commands I'm using:
>>> >
>>> >                               =
org.sbml.libsbml.ConversionProperties props =3D new =
org.sbml.libsbml.ConversionProperties();
>>> >
>>> >                               /* add an option that we want to =
flatten */
>>> >                               props.addOption("flatten comp", =
true, "flatten comp");
>>> >
>>> >                               /* add an option to leave ports if =
the user has requested this */
>>> >                               props.addOption("leavePorts", false, =
"unused ports should be listed in the flattened model");
>>> >
>>> >                               =
props.addOption("abortIfUnflattenable", "none");
>>> >
>>> >                               props.addOption("performValidation", =
"false");
>>> >
>>> >                               props.addOption("basePath", path);
>>> >
>>> >                               /* perform the conversion */
>>> >                               if (document.convert(props) !=3D =
libsbmlConstants.LIBSBML_OPERATION_SUCCESS) {
>>> >                                       return null;
>>> >                               }
>>> >
>>> > I'm flattening FA.xml in the attached RAR file.
>>> >
>>> > Chris
>>>=20
>>>=20
>>=20
>>=20
>=20
>=20


--Apple-Mail=_36382626-9315-4A02-AD19-C1F0DC13ED05
Content-Transfer-Encoding: quoted-printable
Content-Type: text/html;
	charset=windows-1252

<html><head><meta http-equiv=3D"Content-Type" content=3D"text/html =
charset=3Dwindows-1252"></head><body style=3D"word-wrap: break-word; =
-webkit-nbsp-mode: space; -webkit-line-break: =
after-white-space;"><br><div style=3D""><br><div>Begin forwarded =
message:</div><br class=3D"Apple-interchange-newline"><blockquote =
type=3D"cite"><div style=3D"margin-top: 0px; margin-right: 0px; =
margin-bottom: 0px; margin-left: 0px;"><span =
style=3D"font-family:'Helvetica'; color:rgba(0, 0, 0, 1.0);"><b>From: =
</b></span><span style=3D"font-family:'Helvetica';">Lucian Smith &lt;<a =
href=3D"mailto:lucianoelsmitho@gmail.com">lucianoelsmitho@gmail.com</a>&gt=
;<br></span></div><div style=3D"margin-top: 0px; margin-right: 0px; =
margin-bottom: 0px; margin-left: 0px;"><span =
style=3D"font-family:'Helvetica'; color:rgba(0, 0, 0, 1.0);"><b>Subject: =
</b></span><span style=3D"font-family:'Helvetica';"><b>Re: =
[libsbml-team] Errors during flatten</b><br></span></div><div =
style=3D"margin-top: 0px; margin-right: 0px; margin-bottom: 0px; =
margin-left: 0px;"><span style=3D"font-family:'Helvetica'; color:rgba(0, =
0, 0, 1.0);"><b>Date: </b></span><span =
style=3D"font-family:'Helvetica';">August 19, 2014 at 12:48:46 PM =
MDT<br></span></div><div style=3D"margin-top: 0px; margin-right: 0px; =
margin-bottom: 0px; margin-left: 0px;"><span =
style=3D"font-family:'Helvetica'; color:rgba(0, 0, 0, 1.0);"><b>To: =
</b></span><span style=3D"font-family:'Helvetica';">"Chris J. Myers" =
&lt;<a =
href=3D"mailto:myers@ece.utah.edu">myers@ece.utah.edu</a>&gt;<br></span></=
div><div style=3D"margin-top: 0px; margin-right: 0px; margin-bottom: =
0px; margin-left: 0px;"><span style=3D"font-family:'Helvetica'; =
color:rgba(0, 0, 0, 1.0);"><b>Cc: </b></span><span =
style=3D"font-family:'Helvetica';">Frank Bergmann &lt;<a =
href=3D"mailto:fbergman@caltech.edu">fbergman@caltech.edu</a>&gt;, =
LibSBML Team &lt;<a =
href=3D"mailto:libsbml-team@caltech.edu">libsbml-team@caltech.edu</a>&gt;<=
br></span></div><br><div><div dir=3D"ltr">Man, that is tricky. &nbsp;OK! =
&nbsp;I'll see what I can do about this; I agree there should be a way =
to do it.<div><br></div><div>-Lucian</div></div><div =
class=3D"gmail_extra"><br><br><div class=3D"gmail_quote">On Tue, Aug 19, =
2014 at 11:08 AM, Chris J. Myers <span dir=3D"ltr">&lt;<a =
href=3D"mailto:myers@ece.utah.edu" =
target=3D"_blank">myers@ece.utah.edu</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 =
.8ex;border-left:1px #ccc solid;padding-left:1ex"><div =
style=3D"word-wrap:break-word">I'm stuck. &nbsp;I thought I could simply =
disable layout before saving and reloading as a libsbml document, but =
this does not work since I'm only saving and loading the top-level. =
&nbsp;The lower levels models in separate files still have layout, and =
it is not practical to load and strip all of the files. &nbsp;I need a =
way to say DO NOT flatten layout through the entire hierarchy. =
&nbsp;<span class=3D"HOEnZb"><font color=3D"#888888">
<br></font></span><div><span class=3D"HOEnZb"><font =
color=3D"#888888">Chris</font></span><div><div =
class=3D"h5"><br><div><br><div><div>On Aug 19, 2014, at 11:19 AM, Lucian =
Smith &lt;<a href=3D"mailto:lucianoelsmitho@gmail.com" =
target=3D"_blank">lucianoelsmitho@gmail.com</a>&gt; wrote:</div>
<br><blockquote type=3D"cite"><div dir=3D"ltr">The abortIfUnflattenable =
options refers to whether or not flattening has been implemented for =
that package or not--a few versions back, that meant that 'layout' would =
be ignored or stripped, since we had not implemented layout flattening. =
&nbsp;But now, we have implemented flattening for layout, so that option =
is now ignored as far as 'layout' goes.<div>

<br></div><div>You should indeed be able to strip the package before =
flattening, though, and your code should work. &nbsp;If it's not, then =
something is awry.</div><div><br></div><div>-Lucian</div></div><div =
class=3D"gmail_extra">

<br><br><div class=3D"gmail_quote">On Tue, Aug 19, 2014 at 10:05 AM, =
Chris J. Myers <span dir=3D"ltr">&lt;<a href=3D"mailto:myers@ece.utah.edu"=
 target=3D"_blank">myers@ece.utah.edu</a>&gt;</span> =
wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 =
.8ex;border-left:1px #ccc solid;padding-left:1ex">

<div style=3D"word-wrap:break-word"><div>I thought setting =
abortIfUnflattenable "none" would allow it to =
continue.</div><div><br></div><div>Also, I thought I removed the layout =
package with this code. &nbsp;If not, how do I remove the layout before =
flatten:</div>

<div><br></div><div><div =
style=3D"margin:0px;font-size:11px;font-family:Monaco"><span =
style=3D"white-space:pre-wrap">			=
</span>org.sbml.libsbml.SBMLReader reader =3D <span =
style=3D"color:#931a68">new</span> org.sbml.libsbml.SBMLReader();</div>

<div style=3D"margin:0px;font-size:11px;font-family:Monaco"><span =
style=3D"white-space:pre-wrap">			=
</span>org.sbml.libsbml.SBMLDocument document =3D =
reader.readSBML(tempFile);</div><div =
style=3D"margin:0px;font-size:11px;font-family:Monaco">

<span style=3D"white-space:pre-wrap">			</span><span =
style=3D"color:#931a68">new</span> File(tempFile).delete();</div><div =
style=3D"margin:0px;font-size:11px;font-family:Monaco;min-height:15px"><sp=
an style=3D"white-space:pre-wrap">			</span><br>

</div><div style=3D"margin:0px;font-size:11px;font-family:Monaco"><span =
style=3D"white-space:pre-wrap">			=
</span>document.enablePackage(org.sbml.libsbml.LayoutExtension.getXmlnsL3V=
1V1(), <span style=3D"color:#3933ff">"layout"</span>, <span =
style=3D"color:#931a68">false</span>);</div>

<div =
style=3D"margin:0px;font-size:11px;font-family:Monaco;color:rgb(78,144,114=
)"><span><span style=3D"white-space:pre-wrap">			=
</span></span>// <span style=3D"color:#91afcb">TODO</span>: Hack to =
allow flatten to work as it crashes with arrays <span =
style=3D"text-decoration:underline">namespace</span></div>

<div style=3D"margin:0px;font-size:11px;font-family:Monaco"><span =
style=3D"white-space:pre-wrap">			=
</span>document.enablePackage(org.sbml.libsbml.ArraysExtension.getXmlnsL3V=
1V1(), <span style=3D"color:#3933ff">"arrays"</span>, <span =
style=3D"color:#931a68">false</span>);</div>

<div style=3D"margin:0px;font-size:11px;font-family:Monaco"><span =
style=3D"white-space:pre-wrap">			=
</span>document.enablePackage(org.sbml.libsbml.CompExtension.getXmlnsL3V1V=
1(), <span style=3D"color:#3933ff">"comp"</span>, <span =
style=3D"color:#931a68">true</span>);</div>

<div style=3D"margin:0px;font-size:11px;font-family:Monaco"><span =
style=3D"white-space:pre-wrap">			=
</span>document.setPackageRequired(<span =
style=3D"color:#3933ff">"comp"</span>, <span =
style=3D"color:#931a68">true</span>);&nbsp;</div>

<div =
style=3D"margin:0px;font-size:11px;font-family:Monaco;color:rgb(78,144,114=
)"><span style=3D"white-space:pre-wrap">			=
</span></div></div><div><br><div><div>On Aug 19, 2014, at 11:01 AM, =
Lucian Smith &lt;<a href=3D"mailto:lucianoelsmitho@gmail.com" =
target=3D"_blank">lucianoelsmitho@gmail.com</a>&gt; wrote:</div>

<br><blockquote type=3D"cite"><div dir=3D"ltr">The model is invalid. =
&nbsp;You would be able to see the problem by looking at the error log =
on the document that failed to flatten. &nbsp;In this =
case:<div><br></div><div><div style=3D"margin:0px">

//  line 567: (layout-20808 [Error]) The value of the =
'layout:reference'</div><div style=3D"margin:0px">//  attribute of a =
&lt;generalGlyph&gt; must be of the 'id' of</div><div =
style=3D"margin:0px">//  an existing element in the &lt;model&gt;.</div>

<div style=3D"margin:0px">//  Reference: L3V1 Layout V1 Section =
3.11</div><div style=3D"margin:0px"><br></div><div =
style=3D"margin:0px">You reference an 'event0' that doesn't =
exist.</div><div style=3D"margin:0px"><br>

</div><div style=3D"margin:0px">-Lucian</div></div></div><div =
class=3D"gmail_extra"><br><br>
<div class=3D"gmail_quote">On Tue, Aug 19, 2014 at 9:54 AM, Frank =
Bergmann <span dir=3D"ltr">&lt;<a href=3D"mailto:fbergman@caltech.edu" =
target=3D"_blank">fbergman@caltech.edu</a>&gt;</span> =
wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 =
.8ex;border-left:1px #ccc solid;padding-left:1ex">


the attachment did not make it through =85 could you send it to me?<br>
<br>
thanks<br>
<span><font color=3D"#888888">Frank<br>
</font></span><div><br>
On Aug 19, 2014, at 9:50 AM, Chris J. Myers &lt;<a =
href=3D"mailto:myers@ece.utah.edu" =
target=3D"_blank">myers@ece.utah.edu</a>&gt; wrote:<br>
<br>
&gt; Hi,<br>
&gt;<br>
&gt; I'm trying to flatten a model and it is failing.&nbsp; Not sure =
why.&nbsp; Is there someway to get more information about why or make it =
less picky so it will not fail?<br>
&gt;<br>
&gt; Here is the commands I'm using:<br>
&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp;org.sbml.libsbml.ConversionProperties props =3D new =
org.sbml.libsbml.ConversionProperties();<br>
&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* add an option that we =
want to flatten */<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;props.addOption("flatten =
comp", true, "flatten comp");<br>
&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* add an option to =
leave ports if the user has requested this */<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp;props.addOption("leavePorts", false, "unused ports should be =
listed in the flattened model");<br>
&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp;props.addOption("abortIfUnflattenable", "none");<br>
&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp;props.addOption("performValidation", "false");<br>
&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp;props.addOption("basePath", path);<br>
&gt;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* perform the =
conversion */<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if =
(document.convert(props) !=3D =
libsbmlConstants.LIBSBML_OPERATION_SUCCESS) {<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp;return null;<br>
&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br>
&gt;<br>
&gt; I'm flattening FA.xml in the attached RAR file.<br>
&gt;<br>
&gt; Chris<br>
<br>
</div></blockquote></div><br></div>
</blockquote></div><br></div></div></blockquote></div><br></div>
=
</blockquote></div><br></div></div></div></div></div></blockquote></div><b=
r></div>
</div></blockquote></div><br></body></html>=

--Apple-Mail=_36382626-9315-4A02-AD19-C1F0DC13ED05--

