From: Chris Myers <atacs-bugs@vlsigroup.ece.utah.edu>
To: myers@ece.utah.edu
Subject: Re: BUG: rate rules on concentrations with changing volumes (PR#6249)
Date: Mon Jul 13 17:19:07 2015

Done for ODE, should decide if add to Montecarlo.  Here is the code:

    /* Adjust if species rate if compartment size is also changing */
    for (i = 0; i < rec->rulesSize; i++) {
      if (GetRuleType( rec->ruleArray[i] ) == RULE_TYPE_RATE_ASSIGNMENT ) {
	varType = GetRuleVarType( rec->ruleArray[i] );
	j = GetRuleIndex( rec->ruleArray[i] );
	if ( varType == SPECIES_RULE ) {
	  if (!HasOnlySubstanceUnitsInSpeciesNode( speciesArray[j] )) {
	    size = GetCurrentSizeInCompartment( GetCompartmentInSpeciesNode(
speciesArray[j] ) );
	    concentration = GetConcentrationInSpeciesNode( speciesArray[j] );
	    for( k = 0; k < compartmentsSize; k++ ) {
	      compartment = compartmentsArray[k];
	      if (compartment == GetCompartmentInSpeciesNode( speciesArray[j] )) {
		f[j] = f[j] + concentration * f[speciesSize+k];
		break;
	      }
	    }
	  }
	} 
      }
    }
